 
 select virtual_table_id, hierarchy_id, to_char(import_ts,'DD-MON-YYYY HH24:MI:SS'),recommendation_code, trunc(sum(total_score)/sum(count),2) avg_score,sum(count) count,sum(transaction_amount) amount
from (
  select 
  virtual_table_id,hierarchy_id,trunc(import_ts,'hh24') import_ts,recommendation_code, sum(total_score) total_score,count(*) count,sum(transaction_amount) transaction_amount
  from COREREP.data_headers1 where 1=1
  and hierarchy_id=5237260000000001381
  and virtual_table_id=5237260000000001221
  and import_ts > TIMESTAMP '2014-06-16 00:00:00'
  and import_ts < TIMESTAMP '2014-07-17 02:00:00'
  group by virtual_table_id,hierarchy_id,recommendation_code,trunc(import_ts,'hh24')
)
group by virtual_table_id,hierarchy_id,recommendation_code,import_ts
order by 3;


"VIRTUAL_TABLE_ID"	"HIERARCHY_ID"	"TO_CHAR(IMPORT_TS,'DD-MON-YYYYHH24:MI:SS')"	"RECOMMENDATION_CODE"	"AVG_SCORE"	"COUNT"	"AMOUNT"
5237260000000001221	5237260000000001381	"16-JUN-2014 00:00:00"	"ACCEPT"	9170.13	88	69152.3
5237260000000001221	5237260000000001381	"16-JUN-2014 01:00:00"	"ACCEPT"	-4538.17	45	23500.73
5237260000000001221	5237260000000001381	"16-JUN-2014 02:00:00"	"ACCEPT"	4524.32	37	41463.14
5237260000000001221	5237260000000001381	"16-JUN-2014 03:00:00"	"ACCEPT"	12978.19	26	25646.98
5237260000000001221	5237260000000001381	"16-JUN-2014 04:00:00"	"ACCEPT"	39569.2	25	25472.99
5237260000000001221	5237260000000001381	"16-JUN-2014 05:00:00"	"ACCEPT"	44393.04	23	16051.39
5237260000000001221	5237260000000001381	"16-JUN-2014 06:00:00"	"ACCEPT"	58411.2	65	67109.39
5237260000000001221	5237260000000001381	"16-JUN-2014 07:00:00"	"ACCEPT"	52839.96	116	75488.96
5237260000000001221	5237260000000001381	"16-JUN-2014 08:00:00"	"ACCEPT"	47643.58	174	137323.72
5237260000000001221	5237260000000001381	"16-JUN-2014 09:00:00"	"ACCEPT"	44352.89	221	152224.43
5237260000000001221	5237260000000001381	"16-JUN-2014 10:00:00"	"ACCEPT"	37727.65	235	158539.4
5237260000000001221	5237260000000001381	"16-JUN-2014 11:00:00"	"ACCEPT"	37646.5	291	236820.02
5237260000000001221	5237260000000001381	"16-JUN-2014 12:00:00"	"ACCEPT"	33274.4	302	236461.8
5237260000000001221	5237260000000001381	"16-JUN-2014 13:00:00"	"ACCEPT"	36464.38	271	219061.94
5237260000000001221	5237260000000001381	"16-JUN-2014 13:00:00"	"DECLINE"	90153	1	105.44
5237260000000001221	5237260000000001381	"16-JUN-2014 14:00:00"	"ACCEPT"	37662.12	253	205532.46
5237260000000001221	5237260000000001381	"16-JUN-2014 15:00:00"	"ACCEPT"	40742.17	224	153984.54
5237260000000001221	5237260000000001381	"16-JUN-2014 16:00:00"	"ACCEPT"	34835.48	212	168436.25
5237260000000001221	5237260000000001381	"16-JUN-2014 17:00:00"	"DECLINE"	90825.66	3	408.46
5237260000000001221	5237260000000001381	"16-JUN-2014 17:00:00"	"ACCEPT"	35748.68	211	205425.83
5237260000000001221	5237260000000001381	"16-JUN-2014 18:00:00"	"ACCEPT"	42341.8	255	216564.34
5237260000000001221	5237260000000001381	"16-JUN-2014 18:00:00"	"DECLINE"	76027	2	1396.12
5237260000000001221	5237260000000001381	"16-JUN-2014 19:00:00"	"DECLINE"	78817.43	30	15367.36
5237260000000001221	5237260000000001381	"16-JUN-2014 19:00:00"	"ACCEPT"	47576.44	338	283788.95
5237260000000001221	5237260000000001381	"16-JUN-2014 20:00:00"	"DECLINE"	77675.28	14	5254.89
5237260000000001221	5237260000000001381	"16-JUN-2014 20:00:00"	"ACCEPT"	48436.19	355	374067.39
5237260000000001221	5237260000000001381	"16-JUN-2014 21:00:00"	"ACCEPT"	49225.17	349	330654.48
5237260000000001221	5237260000000001381	"16-JUN-2014 21:00:00"	"DECLINE"	78047.68	16	7435.95
5237260000000001221	5237260000000001381	"16-JUN-2014 22:00:00"	"ACCEPT"	38787.17	297	259726.62
5237260000000001221	5237260000000001381	"16-JUN-2014 22:00:00"	"DECLINE"	79535.22	9	4452.9
5237260000000001221	5237260000000001381	"16-JUN-2014 23:00:00"	"ACCEPT"	28522.53	217	218646.32
5237260000000001221	5237260000000001381	"16-JUN-2014 23:00:00"	"DECLINE"	79374	5	2219.66
5237260000000001221	5237260000000001381	"17-JUN-2014 00:00:00"	"ACCEPT"	9086.9	114	86009.46
5237260000000001221	5237260000000001381	"17-JUN-2014 01:00:00"	"ACCEPT"	-4700.12	65	103855.47
5237260000000001221	5237260000000001381	"17-JUN-2014 02:00:00"	"ACCEPT"	-8767.62	29	21627.56
5237260000000001221	5237260000000001381	"17-JUN-2014 03:00:00"	"ACCEPT"	3320.84	19	13712.7
5237260000000001221	5237260000000001381	"17-JUN-2014 04:00:00"	"ACCEPT"	17885.8	20	23498.29
5237260000000001221	5237260000000001381	"17-JUN-2014 05:00:00"	"ACCEPT"	55870.66	45	36574.23
5237260000000001221	5237260000000001381	"17-JUN-2014 05:00:00"	"DECLINE"	77101	1	105.44
5237260000000001221	5237260000000001381	"17-JUN-2014 06:00:00"	"ACCEPT"	54152.84	64	45899.36
5237260000000001221	5237260000000001381	"17-JUN-2014 06:00:00"	"DECLINE"	77476	3	1373.86
5237260000000001221	5237260000000001381	"17-JUN-2014 07:00:00"	"DECLINE"	77702	6	3125.85
5237260000000001221	5237260000000001381	"17-JUN-2014 07:00:00"	"ACCEPT"	57181.69	116	88213.33
5237260000000001221	5237260000000001381	"17-JUN-2014 08:00:00"	"ACCEPT"	55306.42	220	288798.38
5237260000000001221	5237260000000001381	"17-JUN-2014 08:00:00"	"DECLINE"	78068.16	6	1723.2
5237260000000001221	5237260000000001381	"17-JUN-2014 09:00:00"	"ACCEPT"	41810.43	216	162878.69
5237260000000001221	5237260000000001381	"17-JUN-2014 09:00:00"	"DECLINE"	75208.5	2	570.84
5237260000000001221	5237260000000001381	"17-JUN-2014 10:00:00"	"ACCEPT"	20400.63	120	74377.75
5237260000000001221	5237260000000001381	"17-JUN-2014 11:00:00"	"ACCEPT"	-4346.64	84	54479.97
5237260000000001221	5237260000000001381	"17-JUN-2014 12:00:00"	"DECLINE"	80501	1	210.88
5237260000000001221	5237260000000001381	"17-JUN-2014 12:00:00"	"ACCEPT"	14952.05	122	81227.65
5237260000000001221	5237260000000001381	"17-JUN-2014 13:00:00"	"DECLINE"	78385.33	3	1264.18
5237260000000001221	5237260000000001381	"17-JUN-2014 13:00:00"	"ACCEPT"	39227.15	299	219810.45
5237260000000001221	5237260000000001381	"17-JUN-2014 14:00:00"	"ACCEPT"	37334.03	265	264493.92
5237260000000001221	5237260000000001381	"17-JUN-2014 14:00:00"	"DECLINE"	77205	6	3873.44
5237260000000001221	5237260000000001381	"17-JUN-2014 15:00:00"	"ACCEPT"	40916.85	258	234437.42
5237260000000001221	5237260000000001381	"17-JUN-2014 15:00:00"	"DECLINE"	76785	6	1493.14
5237260000000001221	5237260000000001381	"17-JUN-2014 16:00:00"	"DECLINE"	79312	7	3691.52
5237260000000001221	5237260000000001381	"17-JUN-2014 16:00:00"	"ACCEPT"	39348.01	255	205148.13
5237260000000001221	5237260000000001381	"17-JUN-2014 17:00:00"	"DECLINE"	80396.44	9	5426.09
5237260000000001221	5237260000000001381	"17-JUN-2014 17:00:00"	"ACCEPT"	41481.72	229	195602.19
5237260000000001221	5237260000000001381	"17-JUN-2014 18:00:00"	"DECLINE"	78340.75	4	1655.03
5237260000000001221	5237260000000001381	"17-JUN-2014 18:00:00"	"ACCEPT"	38932.23	258	204443.09
5237260000000001221	5237260000000001381	"17-JUN-2014 19:00:00"	"ACCEPT"	49068.52	329	269724.1
5237260000000001221	5237260000000001381	"17-JUN-2014 19:00:00"	"DECLINE"	79420.66	3	807.29
5237260000000001221	5237260000000001381	"17-JUN-2014 20:00:00"	"ACCEPT"	48805.69	345	336284.29
5237260000000001221	5237260000000001381	"17-JUN-2014 20:00:00"	"DECLINE"	78573.33	3	5554.23
5237260000000001221	5237260000000001381	"17-JUN-2014 21:00:00"	"DECLINE"	78404.33	6	5465.54
5237260000000001221	5237260000000001381	"17-JUN-2014 21:00:00"	"ACCEPT"	46263.33	326	347641.01
5237260000000001221	5237260000000001381	"17-JUN-2014 22:00:00"	"ACCEPT"	45560.8	278	383308.17
5237260000000001221	5237260000000001381	"17-JUN-2014 22:00:00"	"DECLINE"	75409.2	5	843.52
5237260000000001221	5237260000000001381	"17-JUN-2014 23:00:00"	"ACCEPT"	29353.72	231	222227.18
5237260000000001221	5237260000000001381	"17-JUN-2014 23:00:00"	"DECLINE"	81501	3	875.43
5237260000000001221	5237260000000001381	"18-JUN-2014 00:00:00"	"DECLINE"	75158.5	2	210.88
5237260000000001221	5237260000000001381	"18-JUN-2014 00:00:00"	"ACCEPT"	21894.23	136	126101.43
5237260000000001221	5237260000000001381	"18-JUN-2014 01:00:00"	"ACCEPT"	7802.59	66	56530.61
5237260000000001221	5237260000000001381	"18-JUN-2014 02:00:00"	"ACCEPT"	-23943.62	27	12764.14
5237260000000001221	5237260000000001381	"18-JUN-2014 03:00:00"	"ACCEPT"	-10532.09	22	14438.34
5237260000000001221	5237260000000001381	"18-JUN-2014 04:00:00"	"ACCEPT"	34878.8	15	13548.18
5237260000000001221	5237260000000001381	"18-JUN-2014 05:00:00"	"ACCEPT"	46744.71	42	41571.35
5237260000000001221	5237260000000001381	"18-JUN-2014 05:00:00"	"DECLINE"	77152	1	1045.83
5237260000000001221	5237260000000001381	"18-JUN-2014 06:00:00"	"DECLINE"	76476	2	1182.06
5237260000000001221	5237260000000001381	"18-JUN-2014 06:00:00"	"ACCEPT"	57385.65	66	68936.54
5237260000000001221	5237260000000001381	"18-JUN-2014 07:00:00"	"DECLINE"	78383.5	2	570.84
5237260000000001221	5237260000000001381	"18-JUN-2014 07:00:00"	"ACCEPT"	53997.74	105	92163.55
5237260000000001221	5237260000000001381	"18-JUN-2014 08:00:00"	"ACCEPT"	54077.79	193	170068.7
5237260000000001221	5237260000000001381	"18-JUN-2014 08:00:00"	"DECLINE"	80202	1	1307.59
5237260000000001221	5237260000000001381	"18-JUN-2014 09:00:00"	"ACCEPT"	52232.25	226	159972.61
5237260000000001221	5237260000000001381	"18-JUN-2014 09:00:00"	"DECLINE"	77272.66	6	5524.13
5237260000000001221	5237260000000001381	"18-JUN-2014 10:00:00"	"ACCEPT"	45928.97	293	271561.53
5237260000000001221	5237260000000001381	"18-JUN-2014 10:00:00"	"DECLINE"	79035.2	5	2480.32
5237260000000001221	5237260000000001381	"18-JUN-2014 11:00:00"	"ACCEPT"	43754.85	252	178113.24
5237260000000001221	5237260000000001381	"18-JUN-2014 11:00:00"	"DECLINE"	77965.5	4	5592.17
5237260000000001221	5237260000000001381	"18-JUN-2014 12:00:00"	"ACCEPT"	41220.06	275	240222.81
5237260000000001221	5237260000000001381	"18-JUN-2014 13:00:00"	"ACCEPT"	34616.65	273	246113.74
5237260000000001221	5237260000000001381	"18-JUN-2014 13:00:00"	"DECLINE"	97155.62	8	4626.45
5237260000000001221	5237260000000001381	"18-JUN-2014 14:00:00"	"DECLINE"	77501.33	3	1540.02
5237260000000001221	5237260000000001381	"18-JUN-2014 14:00:00"	"ACCEPT"	36112.18	276	288323.8
5237260000000001221	5237260000000001381	"18-JUN-2014 15:00:00"	"ACCEPT"	35462.94	243	218173.76
5237260000000001221	5237260000000001381	"18-JUN-2014 15:00:00"	"DECLINE"	75382.5	2	476.07
5237260000000001221	5237260000000001381	"18-JUN-2014 16:00:00"	"ACCEPT"	41692.9	209	172629.86
5237260000000001221	5237260000000001381	"18-JUN-2014 16:00:00"	"DECLINE"	79437.22	9	6642.54
5237260000000001221	5237260000000001381	"18-JUN-2014 17:00:00"	"ACCEPT"	37782.69	239	201681.8
5237260000000001221	5237260000000001381	"18-JUN-2014 17:00:00"	"DECLINE"	80140.25	4	1569.76
5237260000000001221	5237260000000001381	"18-JUN-2014 18:00:00"	"ACCEPT"	30775.21	144	121241.5
5237260000000001221	5237260000000001381	"18-JUN-2014 19:00:00"	"ACCEPT"	46844.53	291	263700.44
5237260000000001221	5237260000000001381	"18-JUN-2014 19:00:00"	"DECLINE"	77551.33	3	2309.89
5237260000000001221	5237260000000001381	"18-JUN-2014 20:00:00"	"ACCEPT"	47358.73	339	258216.62
5237260000000001221	5237260000000001381	"18-JUN-2014 20:00:00"	"DECLINE"	77889.66	3	2525.13
5237260000000001221	5237260000000001381	"18-JUN-2014 21:00:00"	"ACCEPT"	47672.69	310	317692.53
5237260000000001221	5237260000000001381	"18-JUN-2014 21:00:00"	"DECLINE"	77473.18	11	2077.76
5237260000000001221	5237260000000001381	"18-JUN-2014 22:00:00"	"ACCEPT"	39139.36	295	293635.48
5237260000000001221	5237260000000001381	"18-JUN-2014 22:00:00"	"DECLINE"	77943.22	9	15437.03
5237260000000001221	5237260000000001381	"18-JUN-2014 23:00:00"	"DECLINE"	76834.9	11	19813.3
5237260000000001221	5237260000000001381	"18-JUN-2014 23:00:00"	"ACCEPT"	35686.75	194	213303.52
5237260000000001221	5237260000000001381	"19-JUN-2014 00:00:00"	"ACCEPT"	9106.07	119	100693.47
5237260000000001221	5237260000000001381	"19-JUN-2014 00:00:00"	"DECLINE"	78109.44	9	6755.61
5237260000000001221	5237260000000001381	"19-JUN-2014 01:00:00"	"ACCEPT"	20338.44	81	96464.22
5237260000000001221	5237260000000001381	"19-JUN-2014 02:00:00"	"ACCEPT"	-1671.91	37	18642.77
5237260000000001221	5237260000000001381	"19-JUN-2014 03:00:00"	"ACCEPT"	21177.84	32	38450.76
5237260000000001221	5237260000000001381	"19-JUN-2014 04:00:00"	"ACCEPT"	16470.8	15	11471.54
5237260000000001221	5237260000000001381	"19-JUN-2014 05:00:00"	"ACCEPT"	44902.68	32	30430.26
5237260000000001221	5237260000000001381	"19-JUN-2014 06:00:00"	"ACCEPT"	47069.66	60	49189.44
5237260000000001221	5237260000000001381	"19-JUN-2014 06:00:00"	"DECLINE"	78288.75	4	3336.77
5237260000000001221	5237260000000001381	"19-JUN-2014 07:00:00"	"ACCEPT"	55713.56	106	94504.9
5237260000000001221	5237260000000001381	"19-JUN-2014 08:00:00"	"ACCEPT"	49061.65	206	161037.3
5237260000000001221	5237260000000001381	"19-JUN-2014 08:00:00"	"DECLINE"	77168.33	3	1471.93
5237260000000001221	5237260000000001381	"19-JUN-2014 09:00:00"	"DECLINE"	78725.22	9	2781.04
5237260000000001221	5237260000000001381	"19-JUN-2014 09:00:00"	"ACCEPT"	49220.67	233	164276.38
5237260000000001221	5237260000000001381	"19-JUN-2014 10:00:00"	"DECLINE"	92766.2	5	5187.64
5237260000000001221	5237260000000001381	"19-JUN-2014 10:00:00"	"ACCEPT"	43880.17	264	220631.19
5237260000000001221	5237260000000001381	"19-JUN-2014 11:00:00"	"DECLINE"	80335	6	2186.53
5237260000000001221	5237260000000001381	"19-JUN-2014 11:00:00"	"ACCEPT"	36850.81	281	238582.84
5237260000000001221	5237260000000001381	"19-JUN-2014 12:00:00"	"ACCEPT"	38180.31	273	219179.39
5237260000000001221	5237260000000001381	"19-JUN-2014 12:00:00"	"DECLINE"	81176.25	4	2104.36
5237260000000001221	5237260000000001381	"19-JUN-2014 13:00:00"	"DECLINE"	124402	3	1447.74
5237260000000001221	5237260000000001381	"19-JUN-2014 13:00:00"	"ACCEPT"	36131.76	270	206963.22
5237260000000001221	5237260000000001381	"19-JUN-2014 14:00:00"	"DECLINE"	78451.4	5	2217.76
5237260000000001221	5237260000000001381	"19-JUN-2014 14:00:00"	"ACCEPT"	38751.93	264	238795.49
5237260000000001221	5237260000000001381	"19-JUN-2014 15:00:00"	"ACCEPT"	37994.6	270	189956.92
5237260000000001221	5237260000000001381	"19-JUN-2014 15:00:00"	"DECLINE"	78908.8	10	7466.68
5237260000000001221	5237260000000001381	"19-JUN-2014 16:00:00"	"DECLINE"	79560.42	7	6182.05
5237260000000001221	5237260000000001381	"19-JUN-2014 16:00:00"	"ACCEPT"	40267.07	264	222552.86
5237260000000001221	5237260000000001381	"19-JUN-2014 17:00:00"	"DECLINE"	77281	9	1981.81
5237260000000001221	5237260000000001381	"19-JUN-2014 17:00:00"	"ACCEPT"	38875.75	234	179281.13
5237260000000001221	5237260000000001381	"19-JUN-2014 18:00:00"	"DECLINE"	154661.66	6	2688.88
5237260000000001221	5237260000000001381	"19-JUN-2014 18:00:00"	"ACCEPT"	13392.12	508	646020.07
5237260000000001221	5237260000000001381	"19-JUN-2014 19:00:00"	"ACCEPT"	13421.6	289	436173.47
5237260000000001221	5237260000000001381	"19-JUN-2014 19:00:00"	"DECLINE"	276374.28	7	1157.04
